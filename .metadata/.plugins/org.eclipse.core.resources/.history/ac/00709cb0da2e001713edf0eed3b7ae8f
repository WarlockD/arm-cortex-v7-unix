#include <os/slist.hpp>
#include <os/stailq.hpp>
#include <sys\queue.h>
#include <os\printk.h>
#include <stm32f7xx.h>
#include <stm32746g_discovery.h>

struct test_entry {
	int value;
	slist_entry<test_entry> list1;
	slist_entry<test_entry> list2;
	stailq_entry<test_entry> stailq1;
	constexpr test_entry() : value(0) {}
	constexpr test_entry(int i) : value(i) {}
};

//slist_head<test_entry> head1(head_field::field);
//slist_head<test_entry>  head2(&test_entry::list2);
slist_head<test_entry,&test_entry::list1> head1;
slist_head<test_entry,&test_entry::list2>  head2;
stailq_head<test_entry,&test_entry::stailq1>  head3;

test_entry stuff[5] = { 1,2,3,4,5 };
template<typename T>
void print_stuff(const char* message, T&& list) {
	int pos=0;
	printk("%s\r\n",message);
	for(auto& v : list){
		printk("    %2d = %d\r\n",pos++, v.value);
	}
	printk("\r\n");
}
void tailq_unittest() {
	for(auto &a : stuff) {
		head3.insert_head(&a);
	//	slist_insert_head(head1,&a,&test_entry::list1);
	}
}

extern "C" void try_list() {
	int count = 22;
	test_entry* e=nullptr;
	for(auto &a : stuff) {
		head1.insert_head(&a);
		if(v.value == 3) e = &a;
	//	slist_insert_head(head1,&a,&test_entry::list1);
	}
	print_stuff("Start",head1);
	head1.remove(e);
	print_stuff("removing 3",head1);
	head1.remove_head();
	print_stuff("remove_head",head1);

	printk("done!\r\n");
	while(1){
	//	printk("tick!\r\n");
	}
}

