/*
 * buf.cpp
 *
 *  Created on: Apr 18, 2017
 *      Author: warlo
 */

#include "buf.h"
#include "ObjectCache.h"

namespace {

};

namespace xv6 {
	disk_buf::buf_cache_t disk_buf::buf_cache;

	disk_buf::disk_buf(dev_t dev, daddr_t sector) : _buf(buf_cache.aquire(dev,sector)){
		read(); // force a read
	}
	disk_buf::~disk_buf(){
		if(_buf->flags & B_DIRTY) write();
		buf_cache.release(_buf);
		_buf = nullptr;
		// make sure we are synced before we exit
	}
	//uint8_t* operator() { return static_cast(uint8_t*)(_data); }

	void buf::read(){
		// force a read
	}
	void buf::write(){
		// force a write
	}


} /* namespace xv6 */
